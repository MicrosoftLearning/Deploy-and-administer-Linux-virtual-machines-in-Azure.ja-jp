---
demo:
  title: 'デモ 03: Azure Linux 仮想マシンのストレージにアクセスする'
  module: 'Guided Project: Deploy and administer Linux virtual machines'
---

# デモ 03: Azure Linux 仮想マシンのストレージにアクセスする

## 資格情報のタスク

+ 仮想マシンを作成します (CLI)。
+ 仮想マシン データ ディスクを追加し、パーティションを構成します。 
+ SMB Azure ファイル共有を Linux VM にマウントします。
+ Linux VM でマネージド ID を割り当てます。 
+ Azure ロールを割り当てます。 
+ AzCopy を使用して Linux VM とデータを送受信します。 

## リソース要件

これらのリソースは、デモンストレーションの前または実行中に作成できます。 
+ リソース グループ
+ Linux 仮想マシン。
+ ファイル共有と BLOB コンテナーを使用したストレージ アカウント。
+ テストに使用するアップロードされたファイル。
+ マネージド ID 

## 参照ステップ

詳細な手順については、次のリンクを参照してください。

+ [クイック スタート: Azure で Azure CLI を使用して Linux 仮想マシンを作成する](https://learn.microsoft.com/en-us/azure/virtual-machines/linux/quick-create-cli)
+ [データ ディスクを Linux VM に接続する](https://learn.microsoft.com/azure/virtual-machines/linux/attach-disk-portal)
+ [SMB ファイル共有を作成する](https://learn.microsoft.com/azure/storage/files/storage-how-to-create-file-share?tabs=azure-portal)
+ [AzCopy を使ってみる](https://learn.microsoft.com/azure/storage/common/storage-use-azcopy-v10)


## 参照スライド

追加のコンテキストには、これらのスライドを使用します。 
+ ストレージ アカウント
+ BLOB コンテナーとファイル
+ ファイルと BLOB
+ マネージド ID
+ ロールベースのアクセス制御

## ディスカッション ポイント

**CLI を使用して仮想マシンを作成する** - リファレンス #1

>別の VM を作成するのではなく、既存の VM を使用できます。

1. Cloud Shell にアクセスする。

1. CLI を使用して仮想マシンを作成します。 これは、受講者が VM を作成するために表示されている 3 番目の方法であることを指摘します。
   
**Linux 仮想マシンにデータ ディスクを追加する** - リファレンス #2

1. ポータルを使用して仮想マシンにデータ ディスクを追加する方法を確認します。 受講者は演習で CLI を使用します。

1. 仮想マシンに接続して、`lsblk` を使用してディスクを一覧表示します。 ディスク サイズとディスクがマウントされていないことに注意してください。

1. `parted` と `partprobe` を使用してディスクを準備します。 参照リンクのコードを使用します。

1. ディスクをマウントして、`df` を使用してマウント ポイントを一覧表示します。 

**仮想マシンから SMB ファイル共有にアクセスする**: リファレンス #3 と受講生用ラボの手順

1. ストレージ アカウントを見つけて、ファイル共有について説明します。

1. マネージド ID を仮想マシンに割り当てます。 ID がストレージ アカウントにアクセスできる必要があります。

1. Linux 仮想マシンからファイル共有にアクセスするためのポータル スクリプトをコピーします。

1. 仮想マシンに接続して、スクリプトを使用してファイルを作成します。 vi エディターを使用できます。

1. スクリプトを実行し、ファイル共有をマウントします。 

**AzCopy を使用して、BLOB ファイルをデータ ドライブにコピーします**: リファレンス #4 と受講生用ラボの手順。

1. BLOB データ ストレージ共同作成者ロールを仮想マシンに追加します。 他の BLOB ロールを確認します。 

1. 仮想マシンに接続して、AzCopy をインストールします。 ファイルの転送に使用できる他のツールを確認します。 

1. AzCopy を使用して、BLOB ストレージからデータ ドライブにファイルを転送します。 ファイルを再び BLOB ストレージに転送することもできます。  
